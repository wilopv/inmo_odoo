<odoo>
    <data>

        <!-- Vista de formulario -->
        <record id="view_inmueble_form" model="ir.ui.view">
            <field name="name">inmo.inmueble.form</field>
            <field name="model">inmo.inmueble</field>
            <field name="arch" type="xml">
                <form string="Inmueble">
                    <header>
                        <button name="%(action_inmueble_catastro_wizard)d"
                                type="action"
                                string="Rellenar datos con referencia de Catastro"
                                class="oe_highlight"
                                context="{'default_inmueble_id': active_id, 'default_referencia_catastral': referencia_catastral}"/>
                        <button name="%(action_inmo_schedule_visit)d"
                                type="action"
                                string="Concertar visita"
                                context="{'default_inmueble_id': active_id, 'default_start': False, 'default_stop': False}"/>
                    </header>
                    <sheet>
                        <group>
                            <group>
                                <field name="nombre"/>
                                <field name="referencia_catastral"/>
                                <field name="estado"/>
                                <field name="tipo_inmueble"/>
                            </group>
                            <group>
                                <field name="calle"/>
                                <field name="calle2"/>
                                <field name="codigo_postal"/>
                                <field name="ciudad"/>
                                <field name="provincia"/>
                                <field name="id_pais"/>
                            </group>
                        </group>
                        <group>
                            <group>
                                <field name="superficie_construida"/>
                            </group>
                            <group>
                                <field name="habitaciones"/>
                                <field name="banos"/>
                            </group>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- Vista de lista -->
        <record id="view_inmueble_tree" model="ir.ui.view">
            <field name="name">inmo.inmueble.tree</field>
            <field name="model">inmo.inmueble</field>
            <field name="arch" type="xml">
                <tree string="Inmuebles">
                    <field name="nombre"/>
                    <field name="estado"/>
                    <field name="tipo_inmueble"/>
                    <field name="ciudad"/>
                    <field name="provincia"/>
                    <field name="superficie_construida"/>
                    <button name="%(action_inmo_schedule_visit)d"
                            type="action"
                            string="Concertar visita"
                            icon="fa-calendar"
                            context="{'default_inmueble_id': id, 'default_start': False, 'default_stop': False}"/>
                </tree>
            </field>
        </record>

        <!-- Vista de kanban -->
                <record id="view_inmueble_kanban" model="ir.ui.view">
            <field name="name">inmo.inmueble.kanban</field>
            <field name="model">inmo.inmueble</field>
            <field name="arch" type="xml">
                <kanban default_group_by="estado" class="o_kanban_small_column">
                    <field name="nombre"/>
                    <field name="miniatura_kanban"/>
                    <field name="estado"/>
                    <field name="tipo_inmueble"/>
                    <field name="ciudad"/>
                    <field name="provincia"/>
                    <field name="superficie_construida"/>
                    <field name="habitaciones"/>
                    <field name="banos"/>

                    <templates>
                        <t t-name="kanban-box">
                            <div class="o_kanban_record o_kanban_has_image o_kanban_card_small">
                                <div class="o_kanban_image o_kanban_image_fill" style="width: 100%;">
                                    <img t-if="record.miniatura_kanban.raw_value"
                                         t-att-src="kanban_image('inmo.inmueble', 'miniatura_kanban', record.id.raw_value)"
                                         alt="Miniatura"
                                         style="width: 100%; height: 140px; object-fit: cover;"/>
                                    <img t-else=""
                                         src="/web/static/img/placeholder.png"
                                         alt="Miniatura"
                                         style="width: 100%; height: 140px; object-fit: cover;"/>
                                </div>
                                <div class="o_kanban_card_content">
                                    <div class="o_kanban_record_title">
                                        <field name="nombre"/>
                                    </div>
                                    <div class="o_kanban_primary_details text-muted">
                                        <span><field name="tipo_inmueble"/> · </span>
                                        <span><field name="estado"/></span>
                                    </div>
                                    <div class="o_kanban_secondary_details">
                                        <div class="o_text_break">
                                            <field name="calle"/>
                                            <t t-if="record.ciudad.raw_value">
                                                , <field name="ciudad"/>
                                            </t>
                                            <t t-if="record.provincia.raw_value">
                                                , <field name="provincia"/>
                                            </t>
                                        </div>
                                        <div class="o_text_break">
                                            <span>Ref. catastral: </span><field name="referencia_catastral"/>
                                        </div>
                                        <div>
                                            <t t-if="record.superficie_construida.raw_value">
                                                <span><field name="superficie_construida"/> m²</span>
                                            </t>
                                            <t t-if="record.habitaciones.raw_value">
                                                <span> · <field name="habitaciones"/> hab.</span>
                                            </t>
                                            <t t-if="record.banos.raw_value">
                                                <span> · <field name="banos"/> baños</span>
                                            </t>
                                        </div>
                                    </div>
                                    <div class="o_kanban_card_footer">
                                        <button type="action"
                                                name="%(action_inmo_schedule_visit)d"
                                                class="btn btn-link p-0"
                                                t-att-context="{'default_inmueble_id': record.id.raw_value, 'default_start': False, 'default_stop': False}">
                                            Concertar visita
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>



        <!-- Vista de búsqueda -->
        <record id="view_inmueble_search" model="ir.ui.view">
            <field name="name">inmo.inmueble.search</field>
            <field name="model">inmo.inmueble</field>
            <field name="arch" type="xml">
                <search string="Buscar Inmuebles">
                    <field name="nombre"/>
                    <field name="referencia_catastral"/>
                    <filter string="Disponibles" name="available" domain="[('estado', '=', 'disponible')]"/>
                    <filter string="Reservados" name="reserved" domain="[('estado', '=', 'reservado')]"/>
                    <filter string="Vendidos" name="sold" domain="[('estado', '=', 'vendido')]"/>
                    <filter string="Alquilados" name="rented" domain="[('estado', '=', 'alquilado')]"/>
                    <group expand="0" string="Agrupar por">
                        <filter string="Tipo de inmueble" name="group_tipo" context="{'group_by': 'tipo_inmueble'}"/>
                        <filter string="Estado" name="group_estado" context="{'group_by': 'estado'}"/>
                        <filter string="Provincia" name="group_provincia" context="{'group_by': 'provincia'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Acción que abre las vistas -->
        <record id="action_inmueble" model="ir.actions.act_window">
            <field name="name">Inmuebles</field>
            <field name="res_model">inmo.inmueble</field>
            <field name="view_mode">kanban,tree,form</field>
            <field name="view_id" ref="view_inmueble_tree"/>
        </record>

        <!-- Menú -->
        <menuitem id="menu_inmo_root" name="Inmuebles"/>

        <menuitem id="menu_inmo_inmueble"
                  name="Inmuebles"
                  parent="menu_inmo_root"
                  action="action_inmueble"/>

    </data>
</odoo>
